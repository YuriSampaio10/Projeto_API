{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block 'title' %}{% endblock %}</title>
    <link rel="stylesheet" href="cadastro.css">
    <link rel="stylesheet" href="{% static 'base.css' %}">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
   {% block 'head' %}
{% endblock 'head' %}
  </head>

<body class="bg-gradient-to-br from-indigo-100 to-blue-50 min-h-screen flex flex-col items-center justify-center font-sans">
  <div class="bg-white shadow-2xl rounded-3xl max-w-4xl w-full mx-auto overflow-hidden border border-gray-200">
    
    <!-- Cabe√ßalho -->
    <div class="bg-gradient-to-r from-indigo-200 to-green-600 p-6 text-center text-white">
         <div class="col-md bg-main d-flex justify-content-center align-items-center" >
            <img class="logo" src="{% static 'Logo.png' %}" alt="Logo" style="width: 120px; height: auto;">
        </div>

      <h1 class="text-3xl font-bold tracking-wide">üí¨ Sua IA Personalizada</h1>
      <p class="text-indigo-100 mt-1 text-sm">Converse com sua intelig√™ncia artificial em tempo real</p>
    </div>

    <!-- √Årea principal -->
    <div class="relative flex flex-col justify-between h-[36rem]">
      <!-- Caixa de respostas -->
      <div id="chat" class="overflow-y-auto p-6 space-y-6 bg-gray-50 scroll-smooth">
        <div id="answer" class="text-gray-700 italic text-center mt-4">
          <p>Comece perguntando algo para a AURYN...</p>
        </div>
      </div>

      <!-- √Årea de entrada -->
      <div class="border-t border-gray-200 bg-white p-4 flex items-center space-x-3">
        <img src="https://ui-avatars.com/api/?name=Voc√™&background=6366F1&color=fff" 
             alt="Usu√°rio" 
             class="h-10 w-10 rounded-full shadow-md">
        
        <form id="ai-form" method="POST" class="flex-grow flex items-center space-x-2">
          <textarea rows="2" 
                    name="question" 
                    id="question"
                    class="flex-grow rounded-xl border border-gray-300 p-3 resize-none focus:ring-2 focus:ring-indigo-400 focus:outline-none text-gray-800 placeholder-gray-400"
                    placeholder="Digite sua pergunta..."></textarea>

          <button id="submit-btn"
                  class="inline-flex items-center justify-center bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-xl px-5 py-2 shadow-lg transition duration-200">
            Enviar üöÄ
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Script -->
  <script>
    document.getElementById('ai-form').addEventListener('submit', async function(event) {
      event.preventDefault();

      const url = "{% url 'ia' %}";
      const question = document.getElementById('question').value;
      const chat = document.getElementById('chat');

      if (!question.trim()) return;

      // Mostra a pergunta do usu√°rio
      const userMessage = `
        <div class="flex justify-end">
          <div class="bg-indigo-600 text-white p-3 rounded-2xl max-w-[75%] shadow-md">
            <p>${question}</p>
          </div>
        </div>
      `;
      chat.insertAdjacentHTML('beforeend', userMessage);
      chat.scrollTop = chat.scrollHeight;

      document.getElementById('question').value = '';

      // Mostra status de carregamento
      const loadingMessage = `
        <div id="loading" class="flex justify-start">
          <div class="bg-gray-200 text-gray-700 p-3 rounded-2xl max-w-[75%] shadow-md italic">
            Pensando...
          </div>
        </div>
      `;
      chat.insertAdjacentHTML('beforeend', loadingMessage);
      chat.scrollTop = chat.scrollHeight;

      const formData = new FormData();
      formData.append('question', question);

      try {
        const response = await fetch(url, { method: 'POST', body: formData });
        const result = await response.text();

        document.getElementById('loading').remove();

        const aiMessage = `
          <div class="flex justify-start">
            <div class="bg-gray-100 text-gray-800 p-3 rounded-2xl max-w-[75%] shadow-md">
              <p>${result}</p>
            </div>
          </div>
        `;
        chat.insertAdjacentHTML('beforeend', aiMessage);
        chat.scrollTop = chat.scrollHeight;
      } catch (error) {
        console.error("Erro:", error);
        document.getElementById('loading').remove();
        chat.insertAdjacentHTML('beforeend', `
          <div class="flex justify-start">
            <div class="bg-red-100 text-red-700 p-3 rounded-2xl max-w-[75%] shadow-md">
              <p>‚ö†Ô∏è Erro ao buscar resposta da IA.</p>
            </div>
          </div>
        `);
      }
    });
  </script>
</body>
</html>